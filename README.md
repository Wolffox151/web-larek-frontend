# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Настройка
Убедитесь что в корне проекта присутствует .env файл в формате:

`
API_ORIGIN = https://yoursite.com
`
## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и их типизация в приложении.
### Интерфейс данных карточек на главной странице.

```
export interface IProduct {
  id: string;
  image: string;
  title: string; 
  category: string;
  price: number | null;
}
```

### Описание данных полей в форме оформления заказа

```
interface IOrderPayment {
  payment?: string;
  address?: string;
}
```

```
export interface IOrderContacts {
  email?: string;
  phone?: string;
}
```

### Модель списка карточек на странице

```
export interface IProductData {
  items: IProduct[];
}
```

### Модель списка карточек в корзине

```
export interface IOrderData {
  items: IProduct[];
}
```

## Архитектура приложения
Код написан в парадигме MVP(Model, View, Presenter)
- Модель отвечает за хранение данных.
- Представление отвечает за отображение данных на странице
- Презентер является связующим звеном между моделью и отображением

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с загаловками запросов.
Методы:
- `get` - Выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектов, который ответил сервер
- `post` - Принимает объект с данными, который будут переданы в JSON в теле запроса и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Клас EventEmitter
Броке событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - полдписка на событие
- `emit` - инициалзиация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными карточек товара. \
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- items: IProduct[] - массив, содержащий в себе карточки.
- preview: string | null - id карточки, выбранной для просмотра в модальном окне.

Так же класс предоставляет метод для взаимодействия с данными.
- getProduct(productId: string): IProduct - возвращает карточку по ее айдишнику.
- getProductList(): IProduct[] - получает список товаров
- getProductPreview(product: IProduct): TProductInfo - превью карточки(модалка)

#### Класс OrderData
Класс отвечает за хранение данных карточек в корзине.
-  items: IProduct[] - список товаров
Так же класс предоставляет метод для взаимодействия с данными.
- addProduct(product: IProduct): void - добавляет товар в корзину.
- removeProduct(product: IProduct['id']): void - удаляет товар из корзины
- getCartData(): IProduct[] | null - получает список товаров из корзины
- getTotalPrice(orderItems: IProduct[]): number | null; - получает стоимость корзины
- getTotalLength(orderItems: IProduct[]): number | null; - получает кол-во товаров
- checkProductinCart(orderItems: IProduct[], product: IProduct): boolean; - проверяяет наличие товара в корзине

### Слой представления

Все классы представления отвечают за отображение данных внутри контейнера (DOM-элемента) и управление взаимодействием с пользователем.

### Класс CardView

Отвечает за отображение карточки товара, включая данные о категории, названии, описании, изображении, цене и кнопку "Заказать" с проверкой наличия товара в корзине. Конструктор класса принимает DOM-элемент шаблона, что позволяет формировать карточки разных вариантов. В классе устанавливаются слушатели на все интерактивные элементы для генерации событий при взаимодействии пользователя.

Поля:
- `templateElement: HTMLElement` — шаблон карточки товара.
- `eventEmitter: EventEmitter` — объект для генерации событий.
- элементы разметки карточки (`categoryElement`, `titleElement`, `descriptionElement`, `imageElement`, `priceElement`, `orderButton`).

Методы:
- `setData(cardData: IProduct): void` — заполняет карточку данными товара.
- `render(): HTMLElement` — возвращает заполненную карточку с установленными слушателями.

### Класс CardsContainer

Класс `CardsContainer` управляет отображением блока с карточками на главной странице, добавлением карточек в контейнер и обновлением его содержимого.

Методы:
- `addCard(cardElement: HTMLElement)` — добавляет карточку в контейнер.
- `set container(newContainer: HTMLElement)` — сеттер для обновления контейнера. Конструктор принимает контейнер, в котором размещаются карточки.

### Класс Modal

Класс `Modal` отвечает за отображение и управление модальными окнами. Методы `open` и `close` контролируют отображение окна, а также установлены слушатели для закрытия окна при нажатии на клавишу Esc, клике на оверлей или кнопку-крестик.

Поля:
- `modal: HTMLElement` — элемент модального окна.
- `event: IEvents` — объект для генерации событий.

**Конструктор**:
- Принимает селектор для идентификации модального окна на странице и экземпляр класса `EventEmitter` для генерации событий.

### Класс ModalWithConfirm

Наследует класс `Modal`. Предназначен для реализации модального окна подтверждения. При открытии сохраняет переданный обработчик, который выполняется при сабмите формы.

Поля:
- `submitButton: HTMLButtonElement` — кнопка подтверждения ("В корзину").
- `_form: HTMLFormElement` — элемент формы.
- `formName: string` — атрибут `name` формы.
- `handleSubmit: Function` — функция подтверждения.

Методы:
- `setValid(isValid: boolean): void` — изменяет активность кнопки подтверждения.
- `open(handleSubmit: Function): void` — открывает окно с обработчиком подтверждения.
- `get form(): HTMLElement` — возвращает элемент формы.

#### Класс ModelWithCard

Класс `ModelWithCard` наследует `ModalWithConfirm` и предназначен для отображения карточки товара с подробной информацией в модальном окне. Обеспечивает отображение основных данных товара, таких как категория, название, описание, изображение и цена.

Поля:
- `categoryElement: HTMLElement` — элемент для отображения категории товара.
- `titleElement: HTMLElement` — элемент для отображения названия товара.
- `descriptionElement: HTMLElement` — элемент для отображения описания товара.
- `imageElement: HTMLImageElement` — элемент для отображения изображения товара.
- `priceElement: HTMLElement` — элемент для отображения цены товара.

Методы:
- `open(data: {category: string, title: string, description: string, image: string, price: string}): void` — расширяет метод родительского класса, заполняя элементы модального окна данными товара (категория, название, описание, изображение, цена).
- `close(): void` — расширяет метод родительского класса, очищая содержимое модального окна при закрытии, чтобы подготовить его к следующему использованию.


### Класс ModalWithForm

Наследует класс `Modal`. Предназначен для отображения модального окна с формой. При сабмите инициирует событие, передавая данные из полей формы. Также генерирует событие изменения данных при вводе. Обеспечивает методы для отображения ошибок и управления кнопкой сохранения.

Поля:
- `submitButton: HTMLButtonElement` — кнопка подтверждения.
- `_form: HTMLFormElement` — элемент формы.
- `formName: string` — атрибут `name` формы.
- `inputs: NodeListOf<HTMLInputElement>` — коллекция полей ввода формы.
- `errors: Record<string, HTMLElement>` — объект для вывода ошибок под полями формы с привязкой к атрибуту `name` инпутов.

Методы:
- `setValid(isValid: boolean): void` — изменяет активность кнопки подтверждения.
- `getInputValues(): Record<string, string>` — возвращает объект с данными из полей формы (ключ — `name` инпута).
- `setInputValues(data: Record<string, string>): void` — заполняет поля формы данными из объекта.

#### Класс Basket

Класс `Basket` управляет отображением корзины товаров в модальном окне и взаимодействием с её содержимым. Корзина отображает список добавленных товаров, их стоимость, общую сумму и предоставляет возможность удалять товары. Также включает кнопку для оформления заказа.

Поля:
- `listProducts: HTMLUListElement` — контейнер для списка товаров в корзине.
- `totalPrice: HTMLElement` — элемент для отображения общей стоимости товаров.
- `cardTemplate: HTMLElement` — шаблон карточки товара, используемый для отображения товаров в корзине.
- `eventEmitter: EventEmitter` — объект для генерации событий при изменениях в корзине.

Методы:
- `order(data: IProduct[]): void` — добавляет товары в корзину, используя шаблон `cardTemplate` для визуализации каждого товара в модальном окне корзины.
- `removeProduct(productId: string): void` — удаляет товар из корзины по его идентификатору.
- `updateTotalPrice(): void` — пересчитывает и обновляет общую стоимость товаров в корзине.
- `render(): void` — перерисовывает содержимое модального окна корзины, отображая актуальный список товаров и общую стоимость.
- `open(): void` — открывает модальное окно корзины, делая её видимой для пользователя.
- `close(): void` — закрывает модальное окно корзины и очищает её содержимое.




### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счёт событий, генерируемых с помощью брокера событий, и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.\

*Список всех событий, которые могут генерироваться в системе:*\

*События изменения данных (генерируются классами моделей данных)*:
- `cards:changed` — изменения массива карточек товаров.
- `cart:updated` — обновление содержимого корзины (например, при добавлении или удалении товаров).
- `cart:totalChanged` — обновление итоговой суммы товаров в корзине.
- `order:created` — создание нового заказа.
- `order:submitted` — подтверждение заказа пользователем.

*События взаимодействия с интерфейсом (генерируются слоями представления)*:
- `card:open` — открытие окна с подробной информацией о товаре.
- `card:close` — закрытие окна с подробной информацией о товаре.
- `card:clear` - очистка окна с подробной информацией о товаре.
- `cart:open` — открытие окна корзины.
- `cart:close` — закрытие окна корзины.
- `orderForm:open` — открытие окна с формой заказа.
- `orderForm:close` — закрытие окна с формой заказа.
- `orderComplete:open` — открытие окна с подтверждением успешного оформления заказа ("Заказ оформлен").
- `orderComplete:close` — закрытие окна с подтверждением успешного оформления заказа.

*События для валидации и отправки форм*:
- `paymentForm:submitted` — отправка данных формы с оплатой и адресом доставки.
- `paymentForm:validationError` — ошибка валидации формы с оплатой и адресом.
- `contactForm:submitted` — отправка данных формы с почтой и номером телефона.
- `contactForm:validationError` — ошибка валидации формы с почтой и номером телефона.

*События взаимодействия с сервером (генерируются классом AppApi)*:
- `api:fetchCards` — получение списка карточек с сервера.
- `api:addToCart` — добавление товара в корзину на сервере.
- `api:removeFromCart` — удаление товара из корзины на сервере.
- `api:createOrder` — создание заказа на сервере.
- `api:submitOrder` — отправка подтверждения заказа на сервер.
