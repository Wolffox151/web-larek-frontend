# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Настройка
Убедитесь что в корне проекта присутствует .env файл в формате:

`
API_ORIGIN = https://yoursite.com
`
## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и их типизация в приложении.
### Интерфейс данных карточек на главной странице.

```
export interface IProduct {
  id: string;
  image: string;
  title: string; 
  category: string;
  price: number | null;
}
```

### Описание данных полей в форме оформления заказа

```
interface IOrderPayment {
  payment?: string;
  address?: string;
}
```

```
export interface IOrderContacts {
  email?: string;
  phone?: string;
}
```

### Модель списка карточек на странице

```
export interface IProductData {
  items: IProduct[];
}
```

### Модель списка карточек в корзине

```
export interface IOrderData {
  items: IProduct[];
}
```

## Архитектура приложения
Код написан в парадигме MVP(Model, View, Presenter)
- Модель отвечает за хранение данных.
- Представление отвечает за отображение данных на странице
- Презентер является связующим звеном между моделью и отображением

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с загаловками запросов.
Методы:
- `get` - Выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектов, который ответил сервер
- `post` - Принимает объект с данными, который будут переданы в JSON в теле запроса и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Клас EventEmitter
Броке событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - полдписка на событие
- `emit` - инициалзиация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными карточек товара. \
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- items: IProduct[] - массив, содержащий в себе карточки.
- preview: string | null - id карточки, выбранной для просмотра в модальном окне.

Так же класс предоставляет метод для взаимодействия с данными.
- getProduct(productId: string): IProduct - возвращает карточку по ее айдишнику.
- getProductList(): IProduct[] - получает список товаров
- getProductPreview(product: IProduct): TProductInfo - превью карточки(модалка)

#### Класс OrderData
Класс отвечает за хранение данных карточек в корзине.
-  items: IProduct[] - список товаров
Так же класс предоставляет метод для взаимодействия с данными.
- addProduct(product: IProduct): void - добавляет товар в корзину.
- removeProduct(product: IProduct['id']): void - удаляет товар из корзины
- getCartData(): IProduct[] | null - получает список товаров из корзины
- getTotalPrice(orderItems: IProduct[]): number | null; - получает стоимость корзины
- getTotalLength(orderItems: IProduct[]): number | null; - получает кол-во товаров
- checkProductinCart(orderItems: IProduct[], product: IProduct): boolean; - проверяяет наличие товара в корзине

### Классы представления
Все классы представления отвечают за отображения внутри контейнера (DOM-элемента) передаваемых в них данных.

#### Класс CardView
Отвечает за отображение карточки товара, включая данные категории, названия, описания, изображения, цены, а также кнопку "Заказать" с проверкой наличия товара в корзине. В конструктор класса передается DOM-элемент шаблона, что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, которые генерируют события при взаимодействии пользователя.

Поля класса содержат элементы разметки карточки. Конструктор, помимо шаблона, принимает экземпляр `EventEmitter` для инициации событий.

Методы:
- `setData(cardData: IProduct): void` — заполняет атрибуты элементов карточки данными.
- `render(): HTMLElement` — метод возвращает полностью заполненную карточку с установленными слушателями.

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Этот класс управляет добавлением карточек в контейнер и полным обновлением его содержимого.

Методы:
- `addCard(cardElement: HTMLElement)` — добавляет карточку в контейнер.
- `set container(newContainer: HTMLElement)` — сеттер для обновления содержимого контейнера. В конструктор принимает контейнер, в котором размещаются карточки.

#### Класс Modal
Реализует модальное окно. Содержит методы `open` и `close` для управления отображением модального окна, а также слушатели для закрытия окна при нажатии на клавишу Esc, клике на оверлей или кнопку-крестик.

Конструктор `Modal` принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно, и экземпляр класса `EventEmitter` для инициации событий.

Поля класса:
- `modal: HTMLElement` — элемент модального окна.
- `event: IEvents` — брокер событий.

#### Класс ModalWithConfirm
Расширяет класс `Modal`. Предназначен для реализации модального окна подтверждения. При открытии модального окна сохраняет переданный в параметрах обработчик, который выполняется при сабмите формы.

Поля класса:
- `submitButton: HTMLButtonElement` — кнопка подтверждения ("В корзину").
- `_form: HTMLFormElement` — элемент формы.
- `formName: string` — значение атрибута `name` формы.
- `handleSubmit: Function` — функция, выполняемая при подтверждении.

Методы:
- `setValid(isValid: boolean): void` — изменяет активность кнопки подтверждения.
- `open(handleSubmit: Function): void` — расширение родительского метода, принимает обработчик для инициации события подтверждения.
- `get form(): HTMLElement` — геттер для получения элемента формы.

#### Класс ModelWithCard
Расширяет класс `ModalWithConfirm`. Предназначен для реализации модального окна отображения карточки товара.

Поля класса:
- `categoryElement: HTMLElement` — элемент для отображения категории товара.
- `titleElement: HTMLElement` — элемент для отображения названия товара.
- `descriptionElement: HTMLElement` — элемент для отображения описания товара.
- `imageElement: HTMLImageElement` — элемент для отображения изображения товара.
- `priceElement: HTMLElement` — элемент для отображения цены товара.

Методы:
- `open(data: {category: string, title: string, description: string, image: string, price: string}): void` — расширение родительского метода, принимает данные для заполнения элементов карточки.
- `close(): void` — расширяет родительский метод, выполняя очистку атрибутов модального окна.

#### Класс ModalWithForm
Расширяет класс `Modal`. Предназначен для реализации модального окна с формой, содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

Поля класса:
- `submitButton: HTMLButtonElement` — кнопка подтверждения.
- `_form: HTMLFormElement` — элемент формы.
- `formName: string` — значение атрибута `name` формы.
- `inputs: NodeListOf<HTMLInputElement>` — коллекция полей ввода формы.
- `errors: Record<string, HTMLElement>` — объект, хранящий элементы для вывода ошибок под полями формы с привязкой к атрибуту `name` инпутов.

Методы:
- `setValid(isValid: boolean): void` — изменяет активность кнопки подтверждения.
- `getInputValues(): Record<string, string>` — возвращает объект с данными из полей формы, где ключ — `name` инпута, значение — данные, введенные пользователем.
- `setInputValues(data: Record<string, string>): void` — принимает объект с данными для заполнения полей формы.

#### Класс Basket
Класс `Basket` отвечает за управление корзиной товаров и их отображение в интерфейсе. Корзина отображает список добавленных товаров, их стоимость, общую сумму и предоставляет возможность удаления товаров. В корзине также есть кнопка для оформления заказа.

Поля класса:
- `listProducts: HTMLUListElement` — контейнер для списка товаров в корзине.
- `totalPrice: HTMLElement` — элемент для отображения общей суммы товаров в корзине.
- `eventEmitter: EventEmitter` — брокер событий для инициирования событий при изменениях в корзине.
- `cardTemplate: HTMLElement` — шаблон карточки товара для отображения элементов в корзине.

Методы:
- `order(data: IProduct[]): void` — добавляет товары в корзину, используя шаблон карточки товара (`cardTemplate`) для отображения.
- `removeProduct(productId: string): void` — удаляет товар из корзины по его идентификатору.
- `updateTotalPrice(): void` — обновляет общую сумму товаров в корзине.
- `render(): void` — перерисовывает содержимое корзины, отображая актуальный список товаров и общую стоимость.
- `close(): void` — закрывает корзину и очищает её содержимое.


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счёт событий, генерируемых с помощью брокера событий, и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.\


*Список всех событий, которые могут генерироваться в системе:*

*События изменения данных (генерируются классами моделей данных)*:
- `cards:changed` — изменения массива карточек товаров.
- `cart:updated` — обновление содержимого корзины (например, при добавлении или удалении товаров).
- `cart:totalChanged` — обновление итоговой суммы товаров в корзине.
- `order:created` — создание нового заказа.
- `order:submitted` — подтверждение заказа пользователем.

*События взаимодействия с интерфейсом (генерируются слоями представления)*:
- `card:open` — открытие окна с подробной информацией о товаре.
- `card:close` — закрытие окна с подробной информацией о товаре.
- `cart:open` — открытие окна корзины.
- `cart:close` — закрытие окна корзины.
- `orderForm:open` — открытие окна с формой заказа.
- `orderForm:close` — закрытие окна с формой заказа.
- `orderComplete:open` — открытие окна с подтверждением успешного оформления заказа ("Заказ оформлен").
- `orderComplete:close` — закрытие окна с подтверждением успешного оформления заказа.
- `form:submitted` — отправка данных формы (например, при оформлении заказа).
- `form:validationError` — ошибка валидации формы при вводе данных.

*События взаимодействия с сервером (генерируются классом AppApi)*:
- `api:fetchCards` — получение списка карточек с сервера.
- `api:addToCart` — добавление товара в корзину на сервере.
- `api:removeFromCart` — удаление товара из корзины на сервере.
- `api:createOrder` — создание заказа на сервере.
- `api:submitOrder` — отправка подтверждения заказа на сервер.
