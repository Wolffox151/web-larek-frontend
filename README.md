# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Настройка
Убедитесь что в корне проекта присутствует .env файл в формате:

`
API_ORIGIN = https://yoursite.com
`
## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и их типизация в приложении.
### Интерфейс данных карточек на главной странице.

```
export interface IProduct {
  id: string;
  image: string;
  title: string; 
  category: string;
  price: number | null;
}
```

### Описание данных полей в форме оформления заказа

```
interface IOrderPayment {
  payment?: string;
  address?: string;
}
```

```
export interface IOrderContacts {
  email?: string;
  phone?: string;
}
```

### Модель списка карточек на странице

```
export interface IProductData {
  items: IProduct[];
}
```

### Модель списка карточек в корзине

```
export interface IOrderData {
  items: IProduct[];
}
```

## Архитектура приложения
Код написан в парадигме MVP(Model, View, Presenter)
- Модель отвечает за хранение данных.
- Представление отвечает за отображение данных на странице
- Презентер является связующим звеном между моделью и отображением

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с загаловками запросов.
Методы:
- `get` - Выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектов, который ответил сервер
- `post` - Принимает объект с данными, который будут переданы в JSON в теле запроса и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Клас EventEmitter
Броке событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - полдписка на событие
- `emit` - инициалзиация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными карточек товара. \
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- items: IProduct[] - массив, содержащий в себе карточки.
- preview: string | null - id карточки, выбранной для просмотра в модальном окне.

Так же класс предоставляет метод для взаимодействия с данными.
- getProduct(productId: string): IProduct - возвращает карточку по ее айдишнику.
- getProductList(): IProduct[] - получает список товаров
- getProductPreview(product: IProduct): TProductInfo - превью карточки(модалка)

#### Класс OrderData
Класс отвечает за хранение данных карточек в корзине.
-  items: IProduct[] - список товаров
Так же класс предоставляет метод для взаимодействия с данными.
- addProduct(product: IProduct): void - добавляет товар в корзину.
- removeProduct(product: IProduct['id']): void - удаляет товар из корзины
- getCartData(): IProduct[] | null - получает список товаров из корзины
- getTotalPrice(orderItems: IProduct[]): number | null; - получает стоимость корзины
- getTotalLength(orderItems: IProduct[]): number | null; - получает кол-во товаров
- checkProductinCart(orderItems: IProduct[], product: IProduct): boolean; - проверяяет наличие товара в корзине

### Классы представления
Все классы представления отвечают за отображения внутри контейнера (DOM-элемента) передаваемых в них данных

#### Клас Card
Отвечает за отображение карточки данные категории, названия, описания, картинки, цена, кнопка заказать с проверкой( наличия товара в корзине )
В констуктор класса передает DOM элемент темплейта, что позволдяет при необходимости формировать карточки разных варинатов верстки. В классе усстанавливается слушатели на все интерактивные элементы, в результати взаимодейтствия с которыми пользователя генерируются соответсвуюзие события.\
Поля класса содержат элементы разметки элементов карточки. констуктор, кроме темплейта принимает экзепмляр `EventEmitter` для инициации событий.\
Методы:
- setData(cardData: IProduct, userID: string): void - заполняет атрибуты элементов карточки данными.
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями

#### Класс CardsContainer
Отвечает за отображение блока с карточки на главной странице.
Методы:
`addCard(cardElement: HTMLElement)` для добавления карточек на страничку
сеттер `container` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.


#### Класс Modal
Реализует модальное окно. Есть методы `open` и `close` для управлением отображения модального окна. Устанавливает слушатели на клавиатуру, для закрытиия модального окна кнопкой Esc, на клик оверлей и кнопку-крестик для закрытия попапа.

-cosntructor(selector: string, events: IEvents) Конструктор пниимает селектор по которому в разметке страницы будет идентифицировано модальное окно и экземляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна.
- event: IEvents - брокер событий

#### Класс ModalWithConfirm
Расширяет класс Modal. Предназначен для реализации модального окна подтверждения. При открытии модального окна сохраняет полученный в параметрах обработчик, который передается для выполнений при сабмите формы\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка подтверждения(В корзину)
- _form: HTMLFormElement - элемент формы.
- forName: string - значения атрибута name формы.
- handleSubmit: Function - функция, на выполнение которой запрашивается подтверждение

Методы:
- setValid(isValid: boolean): void; - изменяет активность кнопки подтверждения
- open(handleSubmit: Function): void; расширение родительского метода принимает обработчик, который передает при инициации события подтверждения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModelWithCard
Расширяет класс ModalWithConfig. Предназначен для реализации модального окна отображения карточки товара.\
- caregory : HTMLElement
- titleElement: HTMLElement
- discriptionElement: HTMLElement
- imageElement: HTMLImageElement
- priceElement: HTMLElement

Методы:
- open(data: {category:string, title:string, description:string, image:string, price:string}): void - расширение родительского метода
- close(): расширяет родительский метод, выполняя дополнительную очистку атрибутов модального окна

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует события передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string= значение атрибута name формы.
- unput: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- error: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
-setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значения - данные введение пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы